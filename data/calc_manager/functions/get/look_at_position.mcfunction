##############################
### 視線先座標を取得する
##############################

### Usage: execute as [Source] at [Destination] run function this
### Example: If you want to get the look-at position of a player, run below.
### execute as @p at @s anchored eyes positioned ^ ^ ^100 anchored feet run function <this>
### Returns: set $X1, $Y1, $Z1 Global to the coordinate X, Y, Z of the non-air point on [Source]'s sight.

### 初期化
execute facing entity @s eyes positioned as 0-0-0-0-20 in overworld run tp 0-0-0-0-20 ~ ~ ~ ~ ~
execute as 0-0-0-0-20 at @s facing ^ ^ ^-1 run tp 0-0-0-0-21 ~ ~0.01 ~ ~ ~
execute store result score $Dimension Global run data get entity @s Dimension 1

### 判定
# overworld
execute if score $Dimension Global matches 0 in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in overworld unless block ~ ~ ~ minecraft:air in overworld run tp 0-0-0-0-21 ~ ~ ~ ~ ~
# nether
execute if score $Dimension Global matches -1 in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in the_nether unless block ~ ~ ~ minecraft:air in overworld run tp 0-0-0-0-21 ~ ~ ~ ~ ~
# end
execute if score $Dimension Global matches 1 in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=3.0,y=3.10,z=3.0,distance=..0.011,sort=furthest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in the_end unless block ~ ~ ~ minecraft:air in overworld run tp 0-0-0-0-21 ~ ~ ~ ~ ~

### 検証
# execute positioned as 0-0-0-0-21 run particle minecraft:explosion ~ ~ ~ 0 0 0 0 1 force

### 取得
execute as 0-0-0-0-21 at @s run function calc_manager:get/pos1
execute as 0-0-0-0-20 at @s run tp 0-0-0-0-21 ~ ~0.01 ~ ~ ~
