##############################
### 視線が通るか判定する
##############################

### Note: Limit of Distance is 153.6m. Limit of Resolution is 0.5m.

### Usage: execute as [Source] at [Destination] run function this
### Example: If you want to check the path between a player and an entity, run below.
### execute as @p at @e[tag=X,limit=1] anchored eyes positioned ^ ^ ^ anchored feet run function <this>
### Returns: $BlockThickness Global == 0 when [Source] can sight on [Destination]
###                                 >= 1 when there are more than 0.1 block between [Source] and [Destination]

### 初期化
execute facing entity @s eyes positioned as 0-0-0-0-20 in overworld run tp 0-0-0-0-20 ~ ~ ~ ~ ~
execute as 0-0-0-0-20 at @s facing ^ ^ ^-1 run tp 0-0-0-0-21 ~ ~0.01 ~ ~ ~
scoreboard players set $BlockThickness Global 0

### ディメンション取得
execute store result score $Dimension Global run data get entity @s Dimension 0

### 判定
# overworld
execute if score $Dimension Global matches 0 in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in overworld unless block ~ ~ ~ minecraft:air run scoreboard players add $BlockThickness Global 1
# nether
execute if score $Dimension Global matches -1 in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in the_nether unless block ~ ~ ~ minecraft:air run scoreboard players add $BlockThickness Global 1
# end
execute if score $Dimension Global matches 1 in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in the_end unless block ~ ~ ~ minecraft:air run scoreboard players add $BlockThickness Global 1

### 判定ライン見たい時
# execute in overworld if entity @s[distance=0..] in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in overworld run particle minecraft:happy_villager ~ ~ ~ 0 0 0 0 1 force
# execute in the_nether if entity @s[distance=0..] in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in the_nether run particle minecraft:happy_villager ~ ~ ~ 0 0 0 0 1 force
# execute in the_end if entity @s[distance=0..] in overworld rotated as 0-0-0-0-20 positioned ^ ^ ^102.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^51.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^51.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^25.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^25.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^12.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^12.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^06.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^06.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^03.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^03.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^01.6 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^01.6 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.8 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.8 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.4 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.4 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.2 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.2 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.1 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.1 rotated as @e[x=0.0,y=2.0,z=0.0,distance=..0.1,sort=nearest,limit=2] positioned ^ ^ ^00.05 if entity @s[distance=..102.4] rotated as 0-0-0-0-20 positioned ^ ^ ^00.05 rotated as 0-0-0-0-20 positioned ^ ^ ^-102.4 in the_end run particle minecraft:happy_villager ~ ~ ~ 0 0 0 0 1 force
